<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaxEasy_ZA â€“ Complete Tax Calculator 2025</title>
    <link rel="stylesheet" href="css/main.css">
    <!-- Inline styles removed for production -->
        :root {
            --primary: #032E61;
            --accent: #B8D200;
            --background: #f5f7fa;
            --white: #ffffff;
            --gray: #6c757d;
            --light-gray: #e9ecef;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--background);
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--white);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, var(--primary), #024A7A);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .logo h1 {
            font-size: 28px;
            font-weight: 700;
        }

        .za {
            color: var(--accent);
        }

        .header-controls {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        select, .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        select {
            background: var(--white);
            color: #333;
        }

        .btn {
            background: var(--accent);
            color: #333;
            text-decoration: none;
            font-weight: 600;
        }

        .btn:hover {
            background: #9BC53D;
            transform: translateY(-2px);
        }

        .progress-container {
            padding: 20px;
            background: var(--light-gray);
        }

        .progress-bar {
            background: #e9ecef;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            background: var(--accent);
            height: 100%;
            width: 20%;
            transition: width 0.3s ease;
        }

        .progress-text {
            text-align: center;
            margin-top: 10px;
            font-weight: 600;
            color: var(--primary);
        }

        nav {
            display: flex;
            background: var(--white);
            border-bottom: 1px solid var(--light-gray);
            overflow-x: auto;
        }

        .nav-item {
            flex: 1;
            padding: 15px;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 600;
            color: var(--gray);
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
        }

        .nav-item.active {
            color: var(--primary);
            border-bottom-color: var(--accent);
            background: rgba(184, 210, 0, 0.1);
        }

        .page {
            display: none;
            padding: 30px;
            animation: fadeIn 0.3s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .welcome-section {
            background: linear-gradient(135deg, var(--accent), #9BC53D);
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            text-align: center;
            color: #333;
        }

        .form-grid {
            display: grid;
            gap: 20px;
            margin-bottom: 30px;
        }

        .form-grid.two-column {
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }

        .form-section {
            background: var(--light-gray);
            padding: 20px;
            border-radius: 8px;
        }

        .form-section h3 {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 18px;
        }

        .input-group {
            margin-bottom: 15px;
            position: relative;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--primary);
        }

        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(184, 210, 0, 0.1);
        }

        .help-icon {
            position: absolute;
            right: 10px;
            top: 38px;
            color: var(--primary);
            cursor: help;
            font-size: 14px;
        }

        .summary-card {
            background: var(--light-gray);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid var(--accent);
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }

        .summary-row:last-child {
            border-bottom: none;
            font-weight: 700;
            color: var(--primary);
            font-size: 18px;
        }

        .btn-group {
            display: flex;
            gap: 15px;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
        }

        .btn-group .btn {
            flex: 1;
            max-width: 200px;
            text-align: center;
        }

        .btn.prev {
            background: var(--gray);
            color: white;
        }

        .btn.prev:hover {
            background: #5a6268;
        }

        .tooltip {
            position: absolute;
            background: #333;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            max-width: 250px;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .tooltip.show {
            opacity: 1;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.show {
            display: block;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            header {
                flex-direction: column;
                text-align: center;
            }
            
            .header-controls {
                justify-content: center;
            }
            
            .form-grid.two-column {
                grid-template-columns: 1fr;
            }
            
            .btn-group {
                flex-direction: column;
            }
            
            .btn-group .btn {
                max-width: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <h1>TaxEasy <span class="za">ZA</span></h1>
            </div>
            <div class="header-controls">
                <select id="langSelect">
                    <option value="en">English</option>
                    <option value="af">Afrikaans</option>
                    <option value="zu">isiZulu</option>
                    <option value="xh">isiXhosa</option>
                    <option value="st">Sesotho</option>
                </select>
                <a href="faq.html" class="btn">FAQ</a>
                <a href="efiling-guide.html" class="btn">eFiling</a>
            </div>
        </header>

        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text">
                <span data-translate="step">Step</span> <span id="currentStep">1</span> <span data-translate="of">of</span> 5
            </div>
        </div>

        <nav>
            <button class="nav-item active" data-step="1">1 Personal</button>
            <button class="nav-item" data-step="2">2 Income</button>
            <button class="nav-item" data-step="3">3 Deductions</button>
            <button class="nav-item" data-step="4">4 Advanced</button>
            <button class="nav-item" data-step="5">5 Summary</button>
        </nav>

        <!-- Page 1: Personal -->
        <div id="page1" class="page active">
            <div class="welcome-section">
                <h2 data-translate="welcome">Welcome to TaxEasy_ZA!</h2>
                <p data-translate="description">Calculate your South African tax for 2025</p>
                <p data-translate="privacy">All data stays in your browser - POPIA compliant</p>
            </div>
            
            <h2>Personal Information</h2>
            <div class="form-grid two-column">
                <div class="input-group">
                    <label data-translate="full_name">Full Name</label>
                    <input type="text" id="fullName" required>
                    <i class="fas fa-question-circle help-icon" title="Enter your legal name"></i>
                </div>
                <div class="input-group">
                    <label data-translate="id_number">ID/Passport</label>
                    <input type="text" id="idNumber" required>
                    <i class="fas fa-question-circle help-icon" title="SA ID or passport number"></i>
                </div>
                <div class="input-group">
                    <label data-translate="age">Age</label>
                    <input type="number" id="age" min="18" max="120" required>
                    <i class="fas fa-question-circle help-icon" title="Your age affects tax rebates"></i>
                </div>
                <div class="input-group">
                    <label data-translate="tax_year">Tax Year</label>
                    <select id="taxYear">
                        <option value="2025">2025 (Mar 2024 - Feb 2025)</option>
                    </select>
                </div>
            </div>
            <div class="btn-group">
                <button class="btn btn-primary" onclick="nextPage()">Next</button>
            </div>
        </div>

        <!-- Page 2: Income -->
        <div id="page2" class="page">
            <h2>Income & IRP5 Information</h2>
            <div class="summary-card">
                <h3>Income Preview</h3>
                <div class="summary-row">
                    <span>Total Income:</span>
                    <span id="totalIncomePreview">R 0.00</span>
                </div>
                <div class="summary-row">
                    <span>Taxable Income:</span>
                    <span id="taxableIncomePreview">R 0.00</span>
                </div>
            </div>
            <div class="summary-card">
                <h3>Tax Bracket Progress</h3>
                <div id="taxBracketVisualization" class="bracket-container">
                    <!-- Dynamic content will be inserted here -->
                </div>
            </div>
            
            <div class="form-grid two-column">
                <div class="input-group">
                    <label>Basic Salary (Code 3601)</label>
                    <input type="number" id="basicSalary" oninput="updatePreview()">
                </div>
                <div class="input-group">
                    <label>Bonus (Code 3605)</label>
                    <input type="number" id="bonus" oninput="updatePreview()">
                </div>
                <div class="input-group">
                    <label>Commission (Code 3606)</label>
                    <input type="number" id="commission" oninput="updatePreview()">
                </div>
                <div class="input-group">
                    <label>Travel Allowance (Code 3701)</label>
                    <input type="number" id="travelAllowance" oninput="updatePreview()">
                </div>
            </div>
            <div class="btn-group">
                <button class="btn prev" onclick="prevPage()">Previous</button>
                <button class="btn btn-primary" onclick="nextPage()">Next</button>
            </div>
        </div>

        <!-- Page 3: Deductions -->
        <div id="page3" class="page">
            <h2>General Deductions</h2>
            <div class="form-grid two-column">
                <div class="input-group">
                    <label>Pension Fund</label>
                    <input type="number" id="pensionFund">
                </div>
                <div class="input-group">
                    <label>Provident Fund</label>
                    <input type="number" id="providentFund">
                </div>
                <div class="input-group">
                    <label>Retirement Annuity</label>
                    <input type="number" id="retirementAnnuity">
                </div>
                <div class="input-group">
                    <label>Medical Aid Contributions</label>
                    <input type="number" id="medicalAid">
                </div>
            </div>
            <div class="btn-group">
                <button class="btn prev" onclick="prevPage()">Previous</button>
                <button class="btn btn-primary" onclick="nextPage()">Next</button>
            </div>
        </div>

        <!-- Page 4: Advanced -->
        <div id="page4" class="page">
            <h2>Advanced Deductions</h2>
            <div class="form-grid two-column">
                <div class="input-group">
                    <label>Professional Expenses</label>
                    <input type="number" id="professionalExpenses">
                </div>
                <div class="input-group">
                    <label>Business Kilometers</label>
                    <input type="number" id="businessKm">
                </div>
                <div class="input-group">
                    <label>Home Office Expenses</label>
                    <input type="number" id="homeOffice">
                </div>
                <div class="input-group">
                    <label>Solar Installation (12B)</label>
                    <input type="number" id="solarInstallation">
                </div>
            </div>
            <div class="btn-group">
                <button class="btn prev" onclick="prevPage()">Previous</button>
                <button class="btn btn-primary" onclick="nextPage()">Next</button>
            </div>
        </div>

        <!-- Page 5: Summary -->
        <div id="page5" class="page">
            <h2>Tax Summary</h2>
            <div class="summary-grid">
                <div class="summary-card">
                    <h3>Income Summary</h3>
                    <div class="summary-row">
                        <span>Gross Income:</span>
                        <span id="grossIncome">R 0.00</span>
                    </div>
                    <div class="summary-row">
                        <span>Taxable Income:</span>
                        <span id="taxableIncome">R 0.00</span>
                    </div>
                </div>
                
                <div class="summary-card">
                    <h3>Tax Calculation</h3>
                    <div class="summary-row">
                        <span>Tax Before Rebates:</span>
                        <span id="taxBeforeRebates">R 0.00</span>
                    </div>
                    <div class="summary-row">
                        <span>Tax Rebates:</span>
                        <span id="taxRebates">R 0.00</span>
                    </div>
                    <div class="summary-row">
                        <span>Tax Payable:</span>
                        <span id="taxPayable">R 0.00</span>
                    </div>
                </div>
                
                <div class="summary-card final-result">
                    <h3>Final Result</h3>
                    <div class="summary-row">
                        <span>Tax Already Paid:</span>
                        <span id="taxPaid">R 0.00</span>
                    </div>
                    <div class="summary-row final">
                        <span id="finalLabel">Amount Due:</span>
                        <span id="finalAmount">R 0.00</span>
                    </div>
                    <div class="summary-row">
                        <span>Effective Tax Rate:</span>
                        <span id="effectiveRate">0.00%</span>
                    </div>
                </div>
            </div>
            <div class="btn-group">
                <button class="btn prev" onclick="prevPage()">Previous</button>
                <button class="btn btn-success" onclick="calculateTax()">Calculate Tax</button>
            </div>
        </div>
    </div>

    <script src="/js/pdf-generator.js"></script>
    <script src="/js/tax-constants-2025.js"></script>
    <script src="/js/language-handler.js"></script>
    <script src="/js/tooltip-handler.js"></script>
    <script src="/js/input-validation.js"></script>
    <script src="/js/app.js"></script>
    <script src="/js/patch.js"></script>
    <script>
        // ðŸ”§ JavaScript Initialization
        let currentPage = 1;
        const translations = {
            en: {
                welcome: "Welcome to TaxEasy_ZA!",
                description: "Calculate your South African tax for 2025",
                privacy: "All data stays in your browser - POPIA compliant",
                full_name: "Full Name",
                id_number: "ID/Passport",
                age: "Age",
                tax_year: "Tax Year",
                step: "Step",
                of: "of",
                next: "Next",
                previous: "Previous",
                calculate: "Calculate Tax"
            },
            af: {
                welcome: "Welkom by TaxEasy_ZA!",
                description: "Bereken jou Suid-Afrikaanse belasting vir 2025",
                privacy: "Alle data bly in jou blaaier - POPIA voldoende",
                full_name: "Volle Naam",
                id_number: "ID/Paspoort",
                age: "Ouderdom",
                tax_year: "Belastingjaar",
                step: "Stap",
                of: "van",
                next: "Volgende",
                previous: "Vorige",
                calculate: "Bereken Belasting"
            },
            zu: {
                welcome: "Siyakwamukela ku-TaxEasy_ZA!",
                description: "Bala intela yakho yaseNingizimu Afrika yonyaka ka-2025",
                privacy: "Yonke imininingwane ihlala kusiphequluli sakho - kuvumelana ne-POPIA",
                full_name: "Igama Eliphelele",
                id_number: "ID/Ipasipoti",
                age: "Iminyaka",
                tax_year: "Unyaka Wentela",
                step: "Isinyathelo",
                of: "kuka",
                next: "Okulandelayo",
                previous: "Okwedlule",
                calculate: "Bala Intela"
            },
            xh: {
                welcome: "Wamkelekile ku-TaxEasy_ZA!",
                description: "Bala irhafu yakho yaseMzantsi Afrika ye-2025",
                privacy: "Yonke imininingwane ihlala kwibhrawuza yakho - ivumelana ne-POPIA",
                full_name: "Igama Elipheleleyo",
                id_number: "ID/Ipasipoti",
                age: "Iminyaka",
                tax_year: "Unyaka Werhafu",
                step: "Inyathelo",
                of: "kuka",
                next: "Okulandelayo",
                previous: "Okwangaphambili",
                calculate: "Bala Irhafu"
            },
            st: {
                welcome: "Re a le amohela ho TaxEasy_ZA!",
                description: "Bala lekgetho la hao la Afrika Borwa la 2025",
                privacy: "Lintlha tsohle li dula mokhatlo oa hao - li lumellana le POPIA",
                full_name: "Lebitso le Feletseng",
                id_number: "ID/Pasipoto",
                age: "Lilemo",
                tax_year: "Ngwaha wa Lekgetho",
                step: "Mohato",
                of: "ho",
                next: "E latelang",
                previous: "E fetileng",
                calculate: "Bala Lekgetho"
            }
        };

        // Tax constants for 2025
        const TAX_CONSTANTS = {
            brackets: [
                { min: 0, max: 95750, rate: 0, description: "0% on first R95,750" },
                { min: 95751, max: 237100, rate: 0.18, base: 0, description: "18% on R95,751 - R237,100" },
                { min: 237101, max: 370500, rate: 0.26, base: 25425, description: "26% on R237,101 - R370,500" },
                { min: 370501, max: 512800, rate: 0.31, base: 60125, description: "31% on R370,501 - R512,800" },
                { min: 512801, max: 673000, rate: 0.36, base: 105429, description: "36% on R512,801 - R673,000" },
                { min: 673001, max: 857900, rate: 0.39, base: 163149, description: "39% on R673,001 - R857,900" },
                { min: 857901, max: 1817000, rate: 0.41, base: 235239, description: "41% on R857,901 - R1,817,000" },
                { min: 1817001, max: Infinity, rate: 0.45, base: 625739, description: "45% on R1,817,001+" }
            ],
            rebates: {
                primary: 17235,
                secondary: 9444,
                tertiary: 3145
            },
            medicalCredits: {
                main: 364,
                firstDependant: 364,
                additional: 246
            }
        };

        // Navigation functions
        function showPage(pageNum) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            
            document.getElementById(`page${pageNum}`).classList.add('active');
            document.querySelector(`[data-step="${pageNum}"]`).classList.add('active');
            
            document.getElementById('currentStep').textContent = pageNum;
            document.getElementById('progressFill').style.width = `${(pageNum - 1) * 25}%`;
        }

        function nextPage() {
            if (currentPage < 5) {
                currentPage++;
                showPage(currentPage);
            }
        }

        function prevPage() {
            if (currentPage > 1) {
                currentPage--;
                showPage(currentPage);
            }
        }

        // Language switching
        function setLanguage(lang) {
            const t = translations[lang];
            document.querySelectorAll('[data-translate]').forEach(el => {
                const key = el.getAttribute('data-translate');
                if (t[key]) el.textContent = t[key];
            });
            localStorage.setItem('language', lang);
        }

        // Preview updates
        function updatePreview() {
            const basic = parseFloat(document.getElementById('basicSalary').value) || 0;
            const bonus = parseFloat(document.getElementById('bonus').value) || 0;
            const commission = parseFloat(document.getElementById('commission').value) || 0;
            const travel = parseFloat(document.getElementById('travelAllowance').value) || 0;
            
            const total = basic + bonus + commission + travel;
            document.getElementById('totalIncomePreview').textContent = `R ${total.toLocaleString('en-ZA', {minimumFractionDigits: 2})}`;
            document.getElementById('taxableIncomePreview').textContent = `R ${total.toLocaleString('en-ZA', {minimumFractionDigits: 2})}`;
        }

        // Tax calculation
        function calculateTax() {
            const age = parseInt(document.getElementById('age').value) || 0;
            const basicSalary = parseFloat(document.getElementById('basicSalary').value) || 0;
            const bonus = parseFloat(document.getElementById('bonus').value) || 0;
            const commission = parseFloat(document.getElementById('commission').value) || 0;
            const travelAllowance = parseFloat(document.getElementById('travelAllowance').value) || 0;
            
            const pensionFund = parseFloat(document.getElementById('pensionFund').value) || 0;
            const providentFund = parseFloat(document.getElementById('providentFund').value) || 0;
            const retirementAnnuity = parseFloat(document.getElementById('retirementAnnuity').value) || 0;
            const medicalAid = parseFloat(document.getElementById('medicalAid').value) || 0;
            const professionalExpenses = parseFloat(document.getElementById('professionalExpenses').value) || 0;
            const businessKm = parseFloat(document.getElementById('businessKm').value) || 0;
            const homeOffice = parseFloat(document.getElementById('homeOffice').value) || 0;
            const solarInstallation = parseFloat(document.getElementById('solarInstallation').value) || 0;

            const grossIncome = basicSalary + bonus + commission + travelAllowance;
            const totalDeductions = pensionFund + providentFund + retirementAnnuity + medicalAid + professionalExpenses + (businessKm * 3.98) + homeOffice + solarInstallation;
            const taxableIncome = Math.max(0, grossIncome - totalDeductions);

            let tax = 0;
            for (const bracket of TAX_CONSTANTS.brackets) {
                if (taxableIncome > bracket.max) continue;
                tax = bracket.base + (taxableIncome - bracket.min + 1) * bracket.rate;
                break;
            }

            let rebate = TAX_CONSTANTS.rebates.primary;
            if (age >= 65) rebate += TAX_CONSTANTS.rebates.secondary;
            if (age >= 75) rebate += TAX_CONSTANTS.rebates.tertiary;

            const taxPayable = Math.max(0, tax - rebate);

            // Update summary
            document.getElementById('grossIncome').textContent = `R ${grossIncome.toLocaleString('en-ZA', {minimumFractionDigits: 2})}`;
            document.getElementById('taxableIncome').textContent = `R ${taxableIncome.toLocaleString('en-ZA', {minimumFractionDigits: 2})}`;
            document.getElementById('totalDeductions').textContent = `R ${totalDeductions.toLocaleString('en-ZA', {minimumFractionDigits: 2})}`;
            document.getElementById('taxBeforeRebates').textContent = `R ${tax.toLocaleString('en-ZA', {minimumFractionDigits: 2})}`;
            document.getElementById('taxRebates').textContent = `R ${rebate.toLocaleString('en-ZA', {minimumFractionDigits: 2})}`;
            document.getElementById('taxPayable').textContent = `R ${taxPayable.toLocaleString('en-ZA', {minimumFractionDigits: 2})}`;
            document.getElementById('effectiveRate').textContent = `${((taxPayable / grossIncome) * 100).toFixed(2)}%`;

            const finalAmount = taxPayable;
            document.getElementById('finalAmount').textContent = `R ${Math.abs(finalAmount).toLocaleString('en-ZA', {minimumFractionDigits: 2})}`;
            document.getElementById('finalLabel').textContent = finalAmount > 0 ? 'Amount Due:' : 'Refund Due:';
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Navigation
            document.querySelectorAll('[data-step]').forEach(btn => {
                btn.addEventListener('click', function() {
                    currentPage = parseInt(this.getAttribute('data-step'));
                    showPage(currentPage);
                });
            });

            // Language selector
            document.getElementById('langSelect').addEventListener('change', function(e) {
                setLanguage(e.target.value);
            });

            // Load saved language
            const savedLang = localStorage.getItem('language') || 'en';
            document.getElementById('langSelect').value = savedLang;
            setLanguage(savedLang);

            // Tooltips
            document.querySelectorAll('.help-icon').forEach(icon => {
                icon.addEventListener('mouseenter', function(e) {
                    showTooltip(e.target, e.target.getAttribute('title'));
                });
                icon.addEventListener('mouseleave', hideTooltip);
            });

            showPage(1);
        });

        // Tooltip functions
        function showTooltip(element, text) {
            const tooltip = document.createElement('div');
            tooltip.className = 'tooltip show';
            tooltip.textContent = text;
            tooltip.style.position = 'absolute';
            tooltip.style.left = element.offsetLeft + 'px';
            tooltip.style.top = (element.offsetTop + 20) + 'px';
            document.body.appendChild(tooltip);
            setTimeout(() => tooltip.remove(), 3000);
        }

        function hideTooltip() {
            document.querySelectorAll('.tooltip').forEach(t => t.remove());
        }
    </script>
</body>
</html>
